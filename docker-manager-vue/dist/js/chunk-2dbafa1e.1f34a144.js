(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2dbafa1e","chunk-0f67cf38"],{"0d51":function(t,e,a){},"244e":function(t,e,a){"use strict";var s=a("0d51"),i=a.n(s);i.a},"2b49":function(t,e,a){"use strict";var s=a("99a9"),i=a.n(s);i.a},"5bdc":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"container"},[a("el-dialog",{attrs:{title:"docker run",visible:t.runDialogVisible,width:"33%","show-close":!1},on:{"update:visible":function(e){t.runDialogVisible=e},close:t.closeRunForm}},[a("div",{staticClass:"el-dialog-div"},[a("el-scrollbar",{staticStyle:{height:"100%"}},[a("el-form",{attrs:{"label-position":"right","label-width":"80px",model:t.runForm}},[a("el-form-item",{attrs:{label:"名称"}},[a("el-input",{staticClass:"run-input",attrs:{placeholder:"容器名称"},model:{value:t.runForm.name,callback:function(e){t.$set(t.runForm,"name",e)},expression:"runForm.name"}})],1),a("el-form-item",{attrs:{label:"运行命令"}},[a("el-input",{staticClass:"run-input",attrs:{placeholder:"command"},model:{value:t.runForm.command,callback:function(e){t.$set(t.runForm,"command",e)},expression:"runForm.command"}})],1),a("el-form-item",{attrs:{label:"端口映射"}},[t.runForm.portList.length?t._e():a("i",{staticClass:"el-icon-circle-plus-outline",on:{click:t.runPortContent}}),t._l(t.runForm.portList,function(e,s){return a("el-row",{key:s,staticClass:"input-row"},[a("el-input",{attrs:{placeholder:"宿主机端口:容器端口",size:"medium"},model:{value:e.text,callback:function(a){t.$set(e,"text",a)},expression:"item.text"}}),a("div",{staticClass:"input-row-icon"},[a("i",{staticClass:"el-icon-remove-outline",on:{click:function(e){return t.removePortContent(s)}}}),s===t.runForm.portList.length-1?a("i",{staticClass:"el-icon-circle-plus-outline",on:{click:t.runPortContent}}):t._e()])],1)})],2),a("el-form-item",{attrs:{label:"数据挂载"}},[t.runForm.volumeList.length?t._e():a("i",{staticClass:"el-icon-circle-plus-outline",on:{click:t.runVolumeContent}}),t._l(t.runForm.volumeList,function(e,s){return a("el-row",{key:s,staticClass:"input-row"},[a("el-input",{attrs:{placeholder:"宿主机路径:容器路径",size:"medium"},model:{value:e.text,callback:function(a){t.$set(e,"text",a)},expression:"item.text"}}),a("div",{staticClass:"input-row-icon"},[a("i",{staticClass:"el-icon-remove-outline",on:{click:function(e){return t.removeVolumeContent(s)}}}),s===t.runForm.volumeList.length-1?a("i",{staticClass:"el-icon-circle-plus-outline",on:{click:t.runVolumeContent}}):t._e()])],1)})],2),a("el-form-item",{attrs:{label:"连接容器"}},[t.runForm.linkList.length?t._e():a("i",{staticClass:"el-icon-circle-plus-outline",on:{click:t.runLinkContent}}),t._l(t.runForm.linkList,function(e,s){return a("el-row",{key:s,staticClass:"input-row"},[a("el-input",{attrs:{placeholder:"容器名称:别名",size:"medium"},model:{value:e.text,callback:function(a){t.$set(e,"text",a)},expression:"item.text"}}),a("div",{staticClass:"input-row-icon"},[a("i",{staticClass:"el-icon-remove-outline",on:{click:function(e){return t.removeLinkContent(s)}}}),s===t.runForm.linkList.length-1?a("i",{staticClass:"el-icon-circle-plus-outline",on:{click:t.runLinkContent}}):t._e()])],1)})],2),a("el-form-item",{attrs:{label:"重启机制"}},[a("el-switch",{attrs:{"active-text":"总是重启","inactive-text":"不重启"},model:{value:t.runForm.restart,callback:function(e){t.$set(t.runForm,"restart",e)},expression:"runForm.restart"}})],1)],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.runDialogVisible=!1}}},[t._v("取 消")]),a("el-button",{attrs:{type:"primary",loading:t.runDialogLoading},on:{click:t.runDockerImage}},[t._v("确 定")])],1)]),a("el-dialog",{attrs:{title:"docker run",visible:t.searchDialogVisible,width:"50%",center:""},on:{"update:visible":function(e){t.searchDialogVisible=e},close:t.closeSearchDialog}},[a("span",{attrs:{slot:"title"},slot:"title"},[a("div",{staticClass:"hub-search"},[a("el-input",{staticStyle:{width:"40%"},attrs:{placeholder:"请输入镜像名称"},model:{value:t.searchHubName,callback:function(e){t.searchHubName=e},expression:"searchHubName"}},[a("el-button",{attrs:{slot:"append",disabled:t.searchLoading},on:{click:t.searchDockerHub},slot:"append"},[t._v("docker search")])],1)],1)]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.searchLoading,expression:"searchLoading"}],staticClass:"el-dialog-div"},[a("el-scrollbar",{staticStyle:{height:"100%"}},[a("el-table",{attrs:{data:t.searchResultData}},[a("el-table-column",{attrs:{prop:"name",label:"镜像名称","min-width":"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.description?a("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v(t._s(e.row.description))]),a("span",[t._v(t._s(e.row.name))])]):a("span",[t._v(t._s(e.row.name))])]}}])}),a("el-table-column",{attrs:{label:"官方镜像",width:"140",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.is_official?a("i",{staticClass:"el-icon-star-on"}):t._e()]}}])}),a("el-table-column",{attrs:{label:"TAG",width:"180"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-input",{attrs:{placeholder:"latest"},model:{value:e.row.tag,callback:function(a){t.$set(e.row,"tag",a)},expression:"scope.row.tag"}})]}}])}),a("el-table-column",{attrs:{label:"操作",width:"140",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("docker pull")]),a("el-button",{staticStyle:{margin:"auto"},attrs:{type:"primary",size:"mini"},on:{click:function(a){return t.handlePull(e.$index,e.row)}}},[t._v("拉取")])],1)]}}])})],1)],1)],1)]),a("div",{staticClass:"select"},[a("div",{staticClass:"select-left"},[a("label",{staticClass:"select-label"},[t._v("服务器")]),a("el-select",{attrs:{filterable:"",placeholder:"请选择服务器"},model:{value:t.host,callback:function(e){t.host=e},expression:"host"}},t._l(t.hostList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1),a("div",[a("i",{staticClass:"el-icon-refresh",on:{click:t.handleRefresh}})]),a("div",{staticClass:"docker-hub-btn"},[a("el-button",{attrs:{type:"primary",plain:""},on:{click:t.handleHubBtn}},[t._v("DockerHub")])],1)],1),a("div",{staticClass:"select-right"},[a("div",{staticClass:"search"},[a("lin-search",{attrs:{placeholder:"镜像名称或镜像id",searchKeyWord:t.searchWord},on:{query:t.onQueryChange}})],1)])]),a("div",{staticClass:"table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.imageList,stripe:""}},[a("el-table-column",{attrs:{fixed:"",prop:"name",label:"镜像名称","show-overflow-tooltip":!0,"min-width":"350"}}),a("el-table-column",{attrs:{label:"TAG","show-overflow-tooltip":!0,width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{type:"info"}},[t._v(t._s(e.row.tag)+"\n          ")])]}}])}),a("el-table-column",{attrs:{prop:"id",label:"镜像ID",width:"240"}}),a("el-table-column",{attrs:{label:"创建时间",width:"240"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[a("i",{staticClass:"el-icon-time"})]),a("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(e.row.created))])]}}])}),a("el-table-column",{attrs:{prop:"size",label:"size",width:"200"}}),a("el-table-column",{attrs:{prop:"DockerVersion",label:"DockerVersion",width:"240"}}),a("el-table-column",{attrs:{width:"180",align:"center",fixed:"right",label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("docker run")]),a("el-button",{staticStyle:{margin:"auto"},attrs:{size:"mini",type:"primary"},on:{click:function(a){return t.handleRun(e.$index,e.row)}}},[t._v("运行")])],1),a("el-tooltip",{attrs:{effect:"dark",placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[t._v("docker rmi")]),a("el-button",{staticStyle:{margin:"auto"},attrs:{size:"mini",type:"danger"},on:{click:function(a){return t.handleDelete(e.$index,e.row)}}},[t._v("删除")])],1)]}}])})],1)],1),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{background:"","hide-on-single-page":!0,layout:"prev, pager, next","current-page":t.page,"page-size":10,total:t.total},on:{"current-change":t.handleCurrentChange}})],1)],1)},i=[],n=a("bc3a"),o=a.n(n),r=a("8eab"),l={components:{LinSearch:r["default"]},data:function(){return{loading:!1,hostList:[],host:"",imageList:[],page:1,pages:1,total:0,searchWord:"",runDialogVisible:!1,searchDialogVisible:!1,runDialogLoading:!1,searchLoading:!1,runForm:{image:"",name:null,command:null,linkList:[],portList:[],volumeList:[],restart:!0},searchResultData:[],searchHubName:""}},mounted:function(){document.body.clientWidth>1200&&document.body.clientWidth<1330&&(this.showTeam=!0),this.getHostList()},watch:{host:function(){this.page=1,this.total=0,this.pages=1,this.searchWord="",this.getImageList()}},methods:{handleRefresh:function(){this.page=1,this.total=0,this.pages=1,this.getImageList()},searchDockerHub:function(){var t=this;this.searchLoading=!0,o.a.get("/v1/image/search",{params:{host:this.host,image:this.searchHubName}}).then(function(e){t.searchLoading=!1,t.searchResultData=e.data}).catch(function(e){t.searchLoading=!1,e.response.data.error_code&&1e3===e.response.data.error_code?t.$message.error(e.response.data.msg.image[0]):t.$message.error(e.response.data.msg)})},handleHubBtn:function(){this.searchDialogVisible=!0},runDockerImage:function(){var t=this;this.runDialogLoading=!0;var e={};if(e.host=this.host,e.image=this.runForm.image,e.name=this.runForm.name,e.command=this.runForm.command,e.restart=this.runForm.restart,this.runForm.portList){var a="";this.runForm.portList.forEach(function(t){""!==t.text&&(a=a+","+t.text)}),a=a.substr(1),e.ports=a}else e.ports="";if(this.runForm.volumeList){var s="";this.runForm.volumeList.forEach(function(t){""!==t.text&&(s=s+","+t.text)}),s=s.substr(1),e.volumes=s}else e.volumes="";if(this.runForm.linkList){var i="";this.runForm.linkList.forEach(function(t){""!==t.text&&(i=i+","+t.text)}),i=i.substr(1),e.links=i}else e.links="";o.a.post("/v1/image/run",e).then(function(e){console.log(e.data),t.runDialogLoading=!1,t.runDialogVisible=!1,t.$message({type:"success",message:"运行成功"}),t.$router.push({path:"/container",query:{id:e.data.id}})}).catch(function(e){t.$message.error(e.response.data.msg),t.runDialogLoading=!1})},closeSearchDialog:function(){this.searchHubName="",this.searchResultData=[]},closeRunForm:function(){this.runForm={image:"",name:null,command:null,linkList:[],portList:[],volumeList:[],restart:!0}},runPortContent:function(){this.runForm.portList.push({text:"",type:"plus"})},removePortContent:function(t){this.runForm.portList.splice(t,1)},runVolumeContent:function(){this.runForm.volumeList.push({text:"",type:"plus"})},removeVolumeContent:function(t){this.runForm.volumeList.splice(t,1)},runLinkContent:function(){this.runForm.linkList.push({text:"",type:"plus"})},removeLinkContent:function(t){this.runForm.linkList.splice(t,1)},onQueryChange:function(t){this.searchWord=t.trim(),this.page=1,this.pages=1,this.total=0,this.getImageList()},getHostList:function(){var t=this;o.a.get("/v1/client/hosts").then(function(e){var a=e.data;t.hostList=a,t.host=t.hostList[0].label}).catch(this.getHostListFail)},getHostListFail:function(t){this.$message.error(t.response.data.msg)},getImageList:function(){this.loading=!0,o.a.get("/v1/image/list",{params:{host:this.host,page:this.page,search:this.searchWord}}).then(this.getImageListSucc).catch(this.getHostListFail)},getImageListSucc:function(t){this.imageList=t.data.data,this.page=t.data.page,this.pages=t.data.pages,this.total=t.data.total,this.loading=!1},handleCurrentChange:function(t){this.page=t,this.getImageList()},handleRun:function(t,e){this.runDialogVisible=!0,this.runForm.image=e.name+":"+e.tag},handleDelete:function(t,e){var a=this;this.$confirm("此操作将永久删除该镜像, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t=e.name+":"+e.tag;a.removeImage(t)})},handlePull:function(t,e){var a=this;this.searchLoading=!0,o.a.get("/v1/image/pull",{params:{host:this.host,image:e.name,tag:e.tag}}).then(function(t){a.searchLoading=!1,a.searchDialogVisible=!1,a.loading=!0,a.$message({type:"success",message:t.data.msg}),a.page=1,a.pages=1,a.total=0,a.getImageList()}).catch(function(t){a.searchLoading=!1,1021===t.response.data.error_code&&a.$message.error(t.response.data.msg)})},removeImage:function(t){var e=this;this.loading=!0,o.a.get("/v1/image/delete",{params:{host:this.host,image:t}}).then(function(t){1===t.data.error_code&&(e.$message({type:"success",message:t.data.msg}),e.page=1,e.pages=1,e.total=0,e.getImageList())}).catch(function(t){e.loading=!1,1016===t.response.data.error_code?e.$message.error(t.response.data.msg):1018===t.response.data.error_code&&e.$message.error(t.response.data.msg)})}}},c=l,u=(a("2b49"),a("2877")),h=Object(u["a"])(c,s,i,!1,null,"7372008a",null);e["default"]=h.exports},"8eab":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"lin-search"},[a("el-input",{staticClass:"input-with-select",attrs:{size:"medium",placeholder:t.placeholder,clearable:""},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}},[a("el-button",{attrs:{slot:"append",icon:"el-icon-search"},slot:"append"})],1)],1)},i=[],n=a("306b"),o={props:{placeholder:{type:String,default:"请输入内容"},searchKeyWord:{type:String,default:""}},watch:{searchKeyWord:function(){this.keyword=this.searchKeyWord}},data:function(){return{keyword:this.searchKeyWord}},created:function(){var t=this;this.$watch("keyword",n["default"].debounce(function(e){t.$emit("query",e)},1e3))},methods:{clear:function(){this.keyword=""}}},r=o,l=(a("244e"),a("2877")),c=Object(l["a"])(r,s,i,!1,null,"7342bd8f",null);e["default"]=c.exports},"99a9":function(t,e,a){}}]);